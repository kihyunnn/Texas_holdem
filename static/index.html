<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>텍사스 홀덤 트래커</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="app-container">
        <header class="main-header">
            <h1>🎲 홀덤 트래커</h1>
            <div class="header-actions">
                <button class="btn-text" onclick="openRankings()">📜 족보</button>
                <button class="btn-secondary small" onclick="openAddPlayerModal()">+ 플레이어</button>
            </div>
        </header>

        <!-- 탭 네비게이션 (3개) -->
        <nav class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('records')">📝 기록</button>
            <button class="tab-btn" onclick="switchTab('stats')">📊 통계</button>
            <button class="tab-btn" onclick="switchTab('players')">👤 플레이어</button>
        </nav>

        <main class="content-area">
            <!-- 탭 1: 기록 (첫 화면 - 게임 리스트만) -->
            <div id="tab-records" class="tab-content active">
                <div class="card full-width">
                    <div class="section-header">
                        <h2>최근 게임 기록</h2>
                        <span class="text-sec">오늘 자정부터의 기록</span>
                    </div>
                    <div id="recentGamesList" class="game-history-list">
                        <!-- JS로 로드됨 -->
                    </div>
                </div>
            </div>

            <!-- 탭 2: 통계 (차트 & 리더보드) -->
            <div id="tab-stats" class="tab-content">
                <!-- 차트 섹션 -->
                <div class="chart-container card full-width" style="margin-bottom: 20px;">
                    <h2>📊 오늘의 현황</h2>
                    <div style="height: 250px; margin-bottom: 20px;">
                        <canvas id="trendChart"></canvas>
                    </div>
                    <div class="chart-stats-row">
                        <div style="width: 48%; height: 200px; display:inline-block;">
                            <h3>승리 핸드 비율</h3>
                            <canvas id="handChart"></canvas>
                        </div>
                        <div style="width: 48%; display:inline-block; vertical-align:top; padding:10px;">
                            <h3>Today's Winner</h3>
                            <div id="topWinnerDiff" style="font-size: 1.2rem; color: #4CAF50; font-weight: bold;">-
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 리더보드 -->
                <div class="card full-width leaderboard-section">
                    <h2>🏆 오늘의 순위</h2>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>순위</th>
                                    <th>이름</th>
                                    <th>승수</th>
                                    <th>획득 금액</th>
                                </tr>
                            </thead>
                            <tbody id="sessionStatsBody">
                                <!-- JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 탭 3: 플레이어 분석 -->
            <div id="tab-players" class="tab-content">
                <div class="card full-width">
                    <h2>👤 플레이어 상세 분석</h2>
                    <div class="player-select-wrapper" style="margin-bottom: 20px;">
                        <select id="analysisPlayerSelect" onchange="loadPlayerAnalysis(this.value)"
                            style="width: 100%; padding: 12px; font-size: 1rem; background: #2C2C2C; color: white; border: 1px solid #444;">
                            <option value="">분석할 플레이어를 선택하세요</option>
                        </select>
                    </div>

                    <div id="playerAnalysisResult" style="display: none;">
                        <div class="stats-grid"
                            style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px;">
                            <div class="stat-box"
                                style="background:#2C2C2C; padding:15px; border-radius:8px; text-align:center;">
                                <div style="color:#aaa; font-size:0.9rem;">총 승리</div>
                                <div id="pa-wins" style="font-size:1.5rem; font-weight:bold; color:#4CAF50;">0회</div>
                            </div>
                            <div class="stat-box"
                                style="background:#2C2C2C; padding:15px; border-radius:8px; text-align:center;">
                                <div style="color:#aaa; font-size:0.9rem;">총 획득 (Pot)</div>
                                <div id="pa-won" style="font-size:1.5rem; font-weight:bold; color:#FFC107;">0</div>
                            </div>
                            <div class="stat-box"
                                style="background:#2C2C2C; padding:15px; border-radius:8px; text-align:center;">
                                <div style="color:#aaa; font-size:0.9rem;">참여 게임</div>
                                <div id="pa-games" style="font-size:1.5rem; font-weight:bold; color:white;">0</div>
                            </div>
                            <div class="stat-box"
                                style="background:#2C2C2C; padding:15px; border-radius:8px; text-align:center;">
                                <div id="pa-winrate-label" style="color:#aaa; font-size:0.9rem;">승률</div>
                                <div id="pa-winrate" style="font-size:1.5rem; font-weight:bold; color:#2196F3;">0%</div>
                            </div>
                        </div>
                        <div style="background:#2C2C2C; padding:15px; border-radius:8px;">
                            <h3>승리 스타일</h3>
                            <p id="pa-style" style="color: #ccc;">데이터 분석 중...</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- FAB (모든 탭에서 보임) -->
        <button class="fab-btn" onclick="openGameModal()">
            <span class="fab-icon">✎</span> RECORD
        </button>
    </div>

    <!-- 게임 기록 모달 -->
    <div id="gameModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>🏆 게임 결과 기록</h3>
                <button class="close-btn" onclick="closeGameModal()">×</button>
            </div>
            <form id="gameForm" onsubmit="handleGameSubmit(event)">
                <div class="form-group">
                    <label for="winnerSelect">승자 (Winner)</label>
                    <select id="winnerSelect" required style="font-size:1.2rem; padding:12px;">
                        <option value="">누가 이겼나요?</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group half">
                        <label for="winningHand">승리 핸드</label>
                        <select id="winningHand">
                            <option value="">(선택 안함)</option>
                            <option value="Royal Flush">로열 플러시</option>
                            <option value="Straight Flush">스트레이트 플러시</option>
                            <option value="Four of a Kind">포 카드</option>
                            <option value="Full House">풀 하우스</option>
                            <option value="Flush">플러시</option>
                            <option value="Straight">스트레이트</option>
                            <option value="Three of a Kind">트리플</option>
                            <option value="Two Pair">투 페어</option>
                            <option value="One Pair">원 페어</option>
                            <option value="High Card">하이 카드</option>
                            <option value="Fold Win">폴드 승</option>
                        </select>
                    </div>
                    <div class="form-group half">
                        <label for="potAmount">획득 금액 (Pot)</label>
                        <input type="number" id="potAmount" required min="0" step="100" placeholder="0"
                            style="font-size:1.2rem;">
                    </div>
                </div>

                <div class="form-group">
                    <label for="gameNotes">메모 / AI 분석용 상황 설명</label>
                    <input type="text" id="gameNotes" placeholder="예: 리버 역전, 블러핑 성공 등">
                </div>

                <div class="modal-actions">
                    <button type="submit" class="btn-primary full-width" style="padding:16px; font-size:1.1rem;">기록
                        저장</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 플레이어 추가 모달 -->
    <div id="addPlayerModal" class="modal">
        <div class="modal-content">
            <h3>새 플레이어 추가</h3>
            <div class="form-group">
                <input type="text" id="newPlayerName" placeholder="이름 입력">
            </div>
            <div class="modal-actions">
                <button class="btn-text" onclick="closeAddPlayerModal()">취소</button>
                <button class="btn-primary" onclick="submitNewPlayer()">추가</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>