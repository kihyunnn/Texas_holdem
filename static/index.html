<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>홀덤 트래커</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="app-container">
        <header class="main-header">
            <h1>Texas Hold'em Tracker</h1>
            <div class="header-actions">
                <button class="btn-icon" onclick="toggleTheme()" id="themeToggle" title="테마 전환">
                    <span id="themeIcon">🌙</span>
                </button>
                <button class="btn-secondary small" onclick="openAddPlayerModal()">+ Player</button>
            </div>
        </header>

        <!-- 5탭 네비게이션 -->
        <nav class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('records')">Games</button>
            <button class="tab-btn" onclick="switchTab('stats')">Stats</button>
            <button class="tab-btn" onclick="switchTab('players')">Players</button>
            <button class="tab-btn" onclick="switchTab('rivalry')">Rivalry</button>
            <button class="tab-btn" onclick="switchTab('rankings')">Hands</button>
        </nav>

        <main class="content-area">
            <!-- 탭 1: 기록 -->
            <div id="tab-records" class="tab-content active">
                <div class="card full-width">
                    <!-- 필터 UI -->
                    <div class="filter-section">
                        <div class="filter-row">
                            <select id="filterScope" onchange="applyFilters()">
                                <option value="today">오늘</option>
                                <option value="all">전체</option>
                                <option value="custom">기간 선택</option>
                            </select>
                            <select id="filterPlayer" onchange="applyFilters()">
                                <option value="">모든 플레이어</option>
                            </select>
                            <select id="filterHand" onchange="applyFilters()">
                                <option value="">모든 핸드</option>
                                <option value="Royal Flush">로열 플러시</option>
                                <option value="Straight Flush">스트레이트 플러시</option>
                                <option value="Four of a Kind">포 카드</option>
                                <option value="Full House">풀 하우스</option>
                                <option value="Flush">플러시</option>
                                <option value="Straight">스트레이트</option>
                                <option value="Three of a Kind">트리플</option>
                                <option value="Two Pair">투 페어</option>
                                <option value="One Pair">원 페어</option>
                                <option value="High Card">하이 카드</option>
                                <option value="Fold Win">폴드 승</option>
                            </select>
                        </div>
                        <div id="customDateRange" class="date-range-row" style="display: none;">
                            <input type="date" id="dateFrom">
                            <span>~</span>
                            <input type="date" id="dateTo">
                            <button class="btn-secondary small" onclick="applyFilters()">적용</button>
                        </div>
                    </div>

                    <div id="recentGamesList" class="game-history-list">
                        <!-- JS -->
                    </div>
                </div>
            </div>

            <!-- 탭 2: 통계 -->
            <div id="tab-stats" class="tab-content">
                <div class="chart-container card full-width" style="margin-bottom: 20px;">
                    <h2>📊 오늘의 현황</h2>
                    <div style="height: 250px; margin-bottom: 20px;">
                        <canvas id="trendChart"></canvas>
                    </div>
                    <div class="chart-stats-row">
                        <div style="width: 48%; height: 200px; display:inline-block;">
                            <h3>승리 핸드 비율</h3>
                            <canvas id="handChart"></canvas>
                        </div>
                        <div style="width: 48%; display:inline-block; vertical-align:top; padding:10px;">
                            <h3>Today's Winner</h3>
                            <div id="topWinnerDiff"
                                style="font-size: 1.2rem; color: var(--primary); font-weight: bold;">-</div>
                        </div>
                    </div>
                </div>

                <div class="card full-width leaderboard-section">
                    <h2>🏆 오늘의 순위</h2>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>순위</th>
                                    <th>이름</th>
                                    <th>승수</th>
                                    <th>획득</th>
                                </tr>
                            </thead>
                            <tbody id="sessionStatsBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 탭 3: 플레이어 분석 (업적 포함) -->
            <div id="tab-players" class="tab-content">
                <div class="card full-width">
                    <h2>👤 플레이어 분석</h2>
                    <select id="analysisPlayerSelect" onchange="loadPlayerAnalysis(this.value)"
                        class="full-width-select">
                        <option value="">플레이어 선택</option>
                    </select>

                    <div id="playerAnalysisResult" style="display: none; margin-top: 20px;">
                        <div class="stats-grid">
                            <div class="stat-box">
                                <div class="stat-label">총 승리</div>
                                <div id="pa-wins" class="stat-value green">0회</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">총 획득</div>
                                <div id="pa-won" class="stat-value gold">₩0</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">주력 핸드</div>
                                <div id="pa-tophand" class="stat-value">-</div>
                            </div>
                        </div>

                        <div class="insight-box" style="margin-top: 16px;">
                            <h3>🤖 AI 인사이트</h3>
                            <p id="pa-insight">분석 중...</p>
                        </div>

                        <div class="achievements-section" style="margin-top: 16px;">
                            <h3>🏅 업적</h3>
                            <div id="achievementsList" class="achievements-grid"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 탭 4: 라이벌 비교 -->
            <div id="tab-rivalry" class="tab-content">
                <div class="card full-width">
                    <h2>⚔️ 라이벌 비교</h2>
                    <div class="rivalry-selects">
                        <select id="rival1Select" class="rivalry-select">
                            <option value="">플레이어 1</option>
                        </select>
                        <span class="vs-text">VS</span>
                        <select id="rival2Select" class="rivalry-select">
                            <option value="">플레이어 2</option>
                        </select>
                    </div>
                    <button class="btn-primary full-width" onclick="compareRivals()"
                        style="margin-top: 16px;">비교하기</button>

                    <div id="rivalryResult" style="display: none; margin-top: 20px;">
                        <div class="rivalry-comparison">
                            <div class="rival-card">
                                <div class="rival-name" id="r1-name">-</div>
                                <div class="rival-stat"><span id="r1-wins">0</span>승</div>
                                <div class="rival-stat gold">₩<span id="r1-won">0</span></div>
                            </div>
                            <div class="vs-divider">⚔️</div>
                            <div class="rival-card">
                                <div class="rival-name" id="r2-name">-</div>
                                <div class="rival-stat"><span id="r2-wins">0</span>승</div>
                                <div class="rival-stat gold">₩<span id="r2-won">0</span></div>
                            </div>
                        </div>
                        <div class="insight-box" style="margin-top: 16px;">
                            <h3>🤖 AI 분석</h3>
                            <p id="rivalry-insight">-</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 탭 5: 족보 -->
            <div id="tab-rankings" class="tab-content">
                <div class="card full-width" style="text-align: center; padding: 10px;">
                    <h2 style="text-align: left;">📜 포커 핸드 랭킹</h2>
                    <img src="images/ranking.png" alt="Poker Hand Rankings" class="rankings-img">
                </div>
            </div>
        </main>

        <!-- FAB -->
        <button class="fab-btn" onclick="openGameModal()">
            <span class="fab-icon">+</span> New Game
        </button>
    </div>

    <!-- 게임 기록 모달 -->
    <div id="gameModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Record Game</h3>
                <button class="close-btn" onclick="closeGameModal()">×</button>
            </div>
            <form id="gameForm" onsubmit="handleGameSubmit(event)">
                <div class="form-group">
                    <label for="winnerSelect">승자 선택</label>
                    <select id="winnerSelect" required class="large-select">
                        <option value="">플레이어 선택</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group half">
                        <label for="winningHand">승리 핸드</label>
                        <select id="winningHand">
                            <option value="">(선택 안함)</option>
                            <option value="Royal Flush">로열 플러시</option>
                            <option value="Straight Flush">스트레이트 플러시</option>
                            <option value="Four of a Kind">포 카드</option>
                            <option value="Full House">풀 하우스</option>
                            <option value="Flush">플러시</option>
                            <option value="Straight">스트레이트</option>
                            <option value="Three of a Kind">트리플</option>
                            <option value="Two Pair">투 페어</option>
                            <option value="One Pair">원 페어</option>
                            <option value="High Card">하이 카드</option>
                            <option value="Fold Win">폴드 승</option>
                        </select>
                    </div>
                    <div class="form-group half">
                        <label for="potAmount">획득 금액</label>
                        <input type="number" id="potAmount" required min="0" step="100" placeholder="0"
                            class="large-input">
                    </div>
                </div>

                <div class="form-group">
                    <label for="gameNotes">메모 (AI 분석용)</label>
                    <input type="text" id="gameNotes" placeholder="예: 리버 역전, 블러핑 성공">
                </div>

                <button type="submit" class="btn-primary full-width large-btn">기록 저장</button>
            </form>
        </div>
    </div>

    <!-- 플레이어 추가 모달 -->
    <div id="addPlayerModal" class="modal">
        <div class="modal-content small">
            <h3>새 플레이어 추가</h3>
            <div class="form-group">
                <input type="text" id="newPlayerName" placeholder="이름 입력">
            </div>
            <div class="modal-actions">
                <button class="btn-text" onclick="closeAddPlayerModal()">취소</button>
                <button class="btn-primary" onclick="submitNewPlayer()">추가</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>